services:
  eos-postgresql:
    image: postgres:17.5
    container_name: eos-postgres
    hostname: eos-postgres
    restart: unless-stopped
    shm_size: 256mb
    environment:
      POSTGRES_DB: postgres
      POSTGRES_USER: ${EOS_POSTGRES_USER}
      POSTGRES_PASSWORD: ${EOS_POSTGRES_PASSWORD}
    ports:
      - "5432:5432"
    networks:
      - eos_network
    volumes:
      - postgres_data:/var/lib/postgresql/data

  eos-seaweedfs:
    image: chrislusf/seaweedfs
    container_name: eos-seaweedfs
    hostname: eos-seaweedfs
    restart: unless-stopped
    environment:
      EOS_S3_ACCESS_KEY_ID: ${EOS_S3_ACCESS_KEY_ID}
      EOS_S3_SECRET_ACCESS_KEY: ${EOS_S3_SECRET_ACCESS_KEY}
    entrypoint: /bin/sh
    command:
      - -c
      - |
        cat > /tmp/s3.json <<CONF
        {"identities":[{"name":"eos","credentials":[{"accessKey":"$$EOS_S3_ACCESS_KEY_ID","secretKey":"$$EOS_S3_SECRET_ACCESS_KEY"}],"actions":["Admin","Read","List","Tagging","Write"]}]}
        CONF
        exec weed server -s3 -s3.config=/tmp/s3.json -dir=/data
    ports:
      - "8333:8333"
    networks:
      - eos_network
    volumes:
      - seaweedfs_data:/data

networks:
  eos_network:
    name: eos_network
    driver: bridge

volumes:
  postgres_data:
    driver: local
  seaweedfs_data:
    driver: local
